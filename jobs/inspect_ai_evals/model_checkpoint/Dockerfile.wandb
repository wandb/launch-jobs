FROM python:3.11-slim

RUN apt-get update && DEBIAN_FRONTEND=noninteractive \
    apt-get install -y --no-install-recommends \
    build-essential git curl ca-certificates \
    && rm -rf /var/lib/apt/lists/*

RUN pip install uv

WORKDIR /workspace

# Copy shared files from parent directory
COPY pyproject.toml launch_secrets.py leaderboard.py ./

# Copy job-specific files from subdirectory
COPY model_checkpoint/ ./

ENV UV_LINK_MODE=copy
RUN --mount=type=cache,target=/root/.cache/uv uv pip install -r pyproject.toml --system

ENV PYTHONUNBUFFERED=1

CMD ["/bin/sh", "-c", "python3 evals-model-checkpoint.py"]